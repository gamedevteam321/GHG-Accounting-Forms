<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mobile Combustion</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .mobile-combustion-container {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 100%;
            margin: 0 auto;
            padding: 24px;
            background: #f8f9fa;
            min-height: 100vh;
        }

        /* Tab Section */
        .tab-section {
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            overflow: hidden;
            margin-bottom: 30px;
        }

        .tab-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 24px 32px;
            border-bottom: 1px solid #e9ecef;
        }

        .tab-header h2 {
            font-size: 24px;
            font-weight: 600;
            color: #2c3e50;
            margin: 0;
        }

        /* Tab Navigation */
        .tab-nav {
            display: flex;
            border-bottom: 2px solid #e9ecef;
            background: #f8f9fa;
        }

        .tab-button {
            flex: 1;
            padding: 16px 24px;
            background: none;
            border: none;
            font-size: 16px;
            font-weight: 500;
            color: #6c757d;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }

        .tab-button.active {
            color: #28a745;
            background: white;
            border-bottom-color: #28a745;
        }

        .tab-button:hover {
            background: #e9ecef;
        }

        .tab-button.active:hover {
            background: white;
        }

        /* Tab Content */
        .tab-content {
            display: none;
            padding: 0;
        }

        .tab-content.active {
            display: block;
        }

        /* Table Actions */
        .table-actions {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            gap: 16px;
            padding: 20px 32px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }

        .add-emission-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .add-emission-btn:hover {
            background: #218838;
            transform: translateY(-1px);
        }

        /* Table Container */
        .table-container {
            overflow-x: auto;
            padding: 20px 32px;
        }

        .emissions-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            min-width: 1600px;
        }

        .emissions-table th,
        .emissions-table td {
            padding: 16px 12px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
            vertical-align: middle;
            font-size: 14px;
            width: 140px;
            min-width: 140px;
            max-width: 140px;
        }

        .emissions-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #495057;
            font-size: 15px;
            padding: 20px 12px;
            border-bottom: 2px solid #dee2e6;
        }

        .emissions-table tbody tr:hover {
            background: #f8f9fa;
        }

        .emissions-table tbody tr.data-entry-row {
            background: #e8f5e8;
            border-left: 4px solid #28a745;
        }

        .emissions-table tbody tr.data-entry-row:hover {
            background: #d4edda;
        }

        /* Special column widths */
        .emissions-table th:nth-child(1),
        .emissions-table td:nth-child(1) {
            width: 80px;
            min-width: 80px;
            max-width: 80px;
            text-align: center;
        }

        .emissions-table th:last-child,
        .emissions-table td:last-child {
            width: 100px;
            min-width: 100px;
            max-width: 100px;
            text-align: center;
        }

        /* Form Controls */
        .form-control {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: white;
            min-height: 44px;
            box-sizing: border-box;
        }

        .form-control:focus {
            outline: none;
            border-color: #28a745;
            box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.1);
        }

        .form-control[readonly] {
            background: #f8f9fa;
            border-color: #dee2e6;
            color: #6c757d;
            cursor: not-allowed;
        }

        .form-control::placeholder {
            color: #adb5bd;
            font-style: italic;
        }

        /* Select styling */
        select.form-control {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 12px center;
            background-repeat: no-repeat;
            background-size: 16px;
            padding-right: 40px;
            appearance: none;
        }

        /* Action Buttons */
        .btn {
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
            transform: translateY(-1px);
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
            transform: translateY(-1px);
        }

        .btn-sm {
            padding: 6px 10px;
            font-size: 12px;
        }

        /* Formula Info */
        .formula-info {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 12px 16px;
            margin: 20px 32px;
            border-radius: 4px;
            font-size: 13px;
            color: #1565c0;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .mobile-combustion-container {
                padding: 16px;
            }

            .tab-header {
                flex-direction: column;
                gap: 16px;
                text-align: center;
            }

            .tab-button {
                font-size: 14px;
                padding: 12px 16px;
            }

            .emissions-table {
                min-width: 1200px;
            }
        }
    </style>
</head>
<body>
    <div class="mobile-combustion-container">
        <!-- Tab Section -->
        <div class="tab-section">
            <div class="tab-header">
                <h2>Mobile Combustion</h2>
            </div>

            <!-- Tab Navigation -->
            <div class="tab-nav">
                <button class="tab-button active" data-tab="fuel-method">
                    <i class="fa fa-gas-pump"></i> Fuel Method
                </button>
                <button class="tab-button" data-tab="transportation-method">
                    <i class="fa fa-truck"></i> Transportation Method
                </button>
            </div>

            <!-- Fuel Method Tab -->
            <div class="tab-content active" id="fuel-method">

                <div class="table-container" style="padding-top: 32px;">
                    <table class="emissions-table" id="fuelMethodTable">
                        <thead>
                            <tr>
                                <th>S.No</th>
                                <th>Date</th>
                                <th>Vehicle No.</th>
                                <th>Fuel Selection</th>
                                <th>Fuel Used</th>
                                <th>Unit Selection</th>
                                <th>EFCO2</th>
                                <th>EFCH4</th>
                                <th>EFN20</th>
                                <th>ECO2</th>
                                <th>ECH4</th>
                                <th>EN20</th>
                                <th>ETCO2eq</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="fuelMethodTableBody">
                            <!-- Data will be populated here -->
                        </tbody>
                    </table>
                </div>

                <div class="formula-info">
                    <strong>Formulas:</strong><br>
                    ECO2 = Fuel Used × EFCO2 | ECH4 = Fuel Used × EFCH4 | EN20 = Fuel Used × EFN20<br>
                    ETCO2eq = ECO2 + ECH4 + EN20 (Only applicable to convert in to unit type form kg to Tonnes)
                </div>
            </div>

            <!-- Transportation Method Tab -->
            <div class="tab-content" id="transportation-method">

                <div class="table-container">
                    <table class="emissions-table" id="transportationMethodTable">
                        <thead>
                            <tr>
                                <th>S.No</th>
                                <th>Date</th>
                                <th>Vehicle No.</th>
                                <th>Transportation Type</th>
                                <th>Distance Traveled</th>
                                <th>Unit Selection</th>
                                <th>EFCO2</th>
                                <th>EFCH4</th>
                                <th>EFN20</th>
                                <th>ECO2</th>
                                <th>ECH4</th>
                                <th>EN20</th>
                                <th>ETCO2eq</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="transportationMethodTableBody">
                            <!-- Data will be populated here -->
                        </tbody>
                    </table>
                </div>

                <div class="formula-info">
                    <strong>Formulas:</strong><br>
                    ECO2 = (Distance Travel/average of transport) × EFCO2 | ECH4 = (Distance Travel/average of transport) × EFCH4 | EN20 = (Distance Travel/average of transport) × EFN20<br>
                    ETCO2eq = ECO2 + ECH4 + EN20 (Only applicable to convert in to unit type form kg to Tonnes)<br>
                    <em>Average transport type will be fixed Constant value to assume = 10</em>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentFuelRowId = 1;
        let currentTransportRowId = 1;
        let isInitialized = false;
        const AVERAGE_TRANSPORT_CONSTANT = 10;

        // Fuel selection options
        const fuelSelections = [
            'Petrol', 'Diesel', 'LPG', 'CNG', 'Aviation Gasoline', 'Jet Kerosene'
        ];

        // Transportation type options
        const transportationTypes = [
            'Car', 'Bus', 'Truck', 'Motorcycle', 'Van', 'Heavy Vehicle'
        ];

        // Unit options
        const unitOptions = ['Tonnes', 'kg', 'Liters'];

        // Initialize the application
        function initializeApp() {
            if (isInitialized) return;

            console.log('Initializing Mobile Combustion...');
            
            // Setup tab functionality
            setupTabs();
            
            // Create entry rows for both tables
            createFuelMethodEntryRow();
            createTransportationMethodEntryRow();
            
            // Load existing data
            loadExistingData();
            
            isInitialized = true;
            console.log('Mobile Combustion initialized successfully');
        }

        // Setup tab functionality
        function setupTabs() {
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');

            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const targetTab = button.dataset.tab;
                    
                    // Remove active class from all buttons and contents
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    tabContents.forEach(content => content.classList.remove('active'));
                    
                    // Add active class to clicked button and corresponding content
                    button.classList.add('active');
                    document.getElementById(targetTab).classList.add('active');
                });
            });
        }

        // Create fuel method entry row
        function createFuelMethodEntryRow() {
            const tbody = document.querySelector('#fuelMethodTableBody');
            const entryRow = document.createElement('tr');
            entryRow.className = 'data-entry-row';
            entryRow.innerHTML = `
                <td><input type="number" class="form-control s-no-input" value="${currentFuelRowId}" readonly></td>
                <td><input type="date" class="form-control date-input" required></td>
                <td><input type="text" class="form-control vehicle-no-input" placeholder="Enter vehicle number"></td>
                <td>
                    <select class="form-control fuel-selection-select">
                        <option value="">Select Fuel</option>
                        ${fuelSelections.map(fuel => `<option value="${fuel}">${fuel}</option>`).join('')}
                    </select>
                </td>
                <td><input type="number" class="form-control fuel-used-input" placeholder="Enter fuel used" step="0.01"></td>
                <td>
                    <select class="form-control unit-selection-select">
                        <option value="">Select Unit</option>
                        ${unitOptions.map(unit => `<option value="${unit}">${unit}</option>`).join('')}
                    </select>
                </td>
                <td><input type="number" class="form-control efco2-input" placeholder="EF CO2" step="0.0001"></td>
                <td><input type="number" class="form-control efch4-input" placeholder="EF CH4" step="0.0001"></td>
                <td><input type="number" class="form-control efn20-input" placeholder="EF N2O" step="0.0001"></td>
                <td><input type="number" class="form-control eco2-input" placeholder="E CO2" step="0.01" readonly></td>
                <td><input type="number" class="form-control ech4-input" placeholder="E CH4" step="0.01" readonly></td>
                <td><input type="number" class="form-control en20-input" placeholder="E N2O" step="0.01" readonly></td>
                <td><input type="number" class="form-control etco2eq-input" placeholder="ET CO2eq" step="0.01" readonly></td>
                <td>
                    <button type="button" class="btn btn-success btn-sm add-row-btn" data-method="fuel">
                        <i class="fa fa-plus"></i> Add
                    </button>
                </td>
            `;

            tbody.appendChild(entryRow);
            setupFuelEntryRowEventListeners(entryRow);
        }

        // Create transportation method entry row
        function createTransportationMethodEntryRow() {
            const tbody = document.querySelector('#transportationMethodTableBody');
            const entryRow = document.createElement('tr');
            entryRow.className = 'data-entry-row';
            entryRow.innerHTML = `
                <td><input type="number" class="form-control s-no-input" value="${currentTransportRowId}" readonly></td>
                <td><input type="date" class="form-control date-input" required></td>
                <td><input type="text" class="form-control vehicle-no-input" placeholder="Enter vehicle number"></td>
                <td>
                    <select class="form-control transportation-type-select">
                        <option value="">Select Transportation Type</option>
                        ${transportationTypes.map(type => `<option value="${type}">${type}</option>`).join('')}
                    </select>
                </td>
                <td><input type="number" class="form-control distance-traveled-input" placeholder="Enter distance" step="0.01"></td>
                <td>
                    <select class="form-control unit-selection-select">
                        <option value="">Select Unit</option>
                        <option value="km">km</option>
                        <option value="miles">miles</option>
                    </select>
                </td>
                <td><input type="number" class="form-control efco2-input" placeholder="EF CO2" step="0.0001"></td>
                <td><input type="number" class="form-control efch4-input" placeholder="EF CH4" step="0.0001"></td>
                <td><input type="number" class="form-control efn20-input" placeholder="EF N2O" step="0.0001"></td>
                <td><input type="number" class="form-control eco2-input" placeholder="E CO2" step="0.01" readonly></td>
                <td><input type="number" class="form-control ech4-input" placeholder="E CH4" step="0.01" readonly></td>
                <td><input type="number" class="form-control en20-input" placeholder="E N2O" step="0.01" readonly></td>
                <td><input type="number" class="form-control etco2eq-input" placeholder="ET CO2eq" step="0.01" readonly></td>
                <td>
                    <button type="button" class="btn btn-success btn-sm add-row-btn" data-method="transportation">
                        <i class="fa fa-plus"></i> Add
                    </button>
                </td>
            `;

            tbody.appendChild(entryRow);
            setupTransportationEntryRowEventListeners(entryRow);
        }

        // Setup fuel method entry row event listeners
        function setupFuelEntryRowEventListeners(row) {
            const fuelUsedInput = row.querySelector('.fuel-used-input');
            const efco2Input = row.querySelector('.efco2-input');
            const efch4Input = row.querySelector('.efch4-input');
            const efn20Input = row.querySelector('.efn20-input');
            const eco2Input = row.querySelector('.eco2-input');
            const ech4Input = row.querySelector('.ech4-input');
            const en20Input = row.querySelector('.en20-input');
            const etco2eqInput = row.querySelector('.etco2eq-input');

            function calculateFuelEmissions() {
                const fuelUsed = parseFloat(fuelUsedInput.value) || 0;
                const efco2 = parseFloat(efco2Input.value) || 0;
                const efch4 = parseFloat(efch4Input.value) || 0;
                const efn20 = parseFloat(efn20Input.value) || 0;

                const eco2 = fuelUsed * efco2;
                const ech4 = fuelUsed * efch4;
                const en20 = fuelUsed * efn20;
                const etco2eq = eco2 + ech4 + en20;

                eco2Input.value = eco2.toFixed(2);
                ech4Input.value = ech4.toFixed(2);
                en20Input.value = en20.toFixed(2);
                etco2eqInput.value = etco2eq.toFixed(2);
            }

            [fuelUsedInput, efco2Input, efch4Input, efn20Input].forEach(input => {
                input.addEventListener('input', calculateFuelEmissions);
            });

            const addBtn = row.querySelector('.add-row-btn');
            addBtn.addEventListener('click', () => addNewFuelRow(row));
        }

        // Setup transportation method entry row event listeners
        function setupTransportationEntryRowEventListeners(row) {
            const distanceInput = row.querySelector('.distance-traveled-input');
            const efco2Input = row.querySelector('.efco2-input');
            const efch4Input = row.querySelector('.efch4-input');
            const efn20Input = row.querySelector('.efn20-input');
            const eco2Input = row.querySelector('.eco2-input');
            const ech4Input = row.querySelector('.ech4-input');
            const en20Input = row.querySelector('.en20-input');
            const etco2eqInput = row.querySelector('.etco2eq-input');

            function calculateTransportationEmissions() {
                const distance = parseFloat(distanceInput.value) || 0;
                const efco2 = parseFloat(efco2Input.value) || 0;
                const efch4 = parseFloat(efch4Input.value) || 0;
                const efn20 = parseFloat(efn20Input.value) || 0;

                // Using the constant average transport value of 10
                const avgTransport = AVERAGE_TRANSPORT_CONSTANT;
                const eco2 = (distance / avgTransport) * efco2;
                const ech4 = (distance / avgTransport) * efch4;
                const en20 = (distance / avgTransport) * efn20;
                const etco2eq = eco2 + ech4 + en20;

                eco2Input.value = eco2.toFixed(2);
                ech4Input.value = ech4.toFixed(2);
                en20Input.value = en20.toFixed(2);
                etco2eqInput.value = etco2eq.toFixed(2);
            }

            [distanceInput, efco2Input, efch4Input, efn20Input].forEach(input => {
                input.addEventListener('input', calculateTransportationEmissions);
            });

            const addBtn = row.querySelector('.add-row-btn');
            addBtn.addEventListener('click', () => addNewTransportationRow(row));
        }

        // Add new fuel row
        function addNewFuelRow(entryRow) {
            const formData = getFuelFormData(entryRow);
            if (!validateFuelFormData(formData)) return;

            // Create display row
            createFuelDisplayRow(formData);
            
            // Clear entry row
            clearFuelEntryRow(entryRow);
            
            // Update serial number
            currentFuelRowId++;
            entryRow.querySelector('.s-no-input').value = currentFuelRowId;
            
            showNotification('Fuel method data added successfully!', 'success');
        }

        // Add new transportation row
        function addNewTransportationRow(entryRow) {
            const formData = getTransportationFormData(entryRow);
            if (!validateTransportationFormData(formData)) return;

            // Create display row
            createTransportationDisplayRow(formData);
            
            // Clear entry row
            clearTransportationEntryRow(entryRow);
            
            // Update serial number
            currentTransportRowId++;
            entryRow.querySelector('.s-no-input').value = currentTransportRowId;
            
            showNotification('Transportation method data added successfully!', 'success');
        }

        // Get fuel form data
        function getFuelFormData(row) {
            return {
                s_no: currentFuelRowId,
                date: row.querySelector('.date-input').value,
                vehicle_no: row.querySelector('.vehicle-no-input').value,
                fuel_selection: row.querySelector('.fuel-selection-select').value,
                fuel_used: parseFloat(row.querySelector('.fuel-used-input').value) || 0,
                unit_selection: row.querySelector('.unit-selection-select').value,
                efco2: parseFloat(row.querySelector('.efco2-input').value) || 0,
                efch4: parseFloat(row.querySelector('.efch4-input').value) || 0,
                efn20: parseFloat(row.querySelector('.efn20-input').value) || 0,
                eco2: parseFloat(row.querySelector('.eco2-input').value) || 0,
                ech4: parseFloat(row.querySelector('.ech4-input').value) || 0,
                en20: parseFloat(row.querySelector('.en20-input').value) || 0,
                etco2eq: parseFloat(row.querySelector('.etco2eq-input').value) || 0
            };
        }

        // Get transportation form data
        function getTransportationFormData(row) {
            return {
                s_no: currentTransportRowId,
                date: row.querySelector('.date-input').value,
                vehicle_no: row.querySelector('.vehicle-no-input').value,
                transportation_type: row.querySelector('.transportation-type-select').value,
                distance_traveled: parseFloat(row.querySelector('.distance-traveled-input').value) || 0,
                unit_selection: row.querySelector('.unit-selection-select').value,
                efco2: parseFloat(row.querySelector('.efco2-input').value) || 0,
                efch4: parseFloat(row.querySelector('.efch4-input').value) || 0,
                efn20: parseFloat(row.querySelector('.efn20-input').value) || 0,
                eco2: parseFloat(row.querySelector('.eco2-input').value) || 0,
                ech4: parseFloat(row.querySelector('.ech4-input').value) || 0,
                en20: parseFloat(row.querySelector('.en20-input').value) || 0,
                etco2eq: parseFloat(row.querySelector('.etco2eq-input').value) || 0
            };
        }

        // Validate fuel form data
        function validateFuelFormData(data) {
            if (!data.date) {
                showNotification('Please select a date', 'error');
                return false;
            }
            if (!data.vehicle_no) {
                showNotification('Please enter vehicle number', 'error');
                return false;
            }
            if (!data.fuel_selection) {
                showNotification('Please select fuel type', 'error');
                return false;
            }
            if (!data.fuel_used || data.fuel_used <= 0) {
                showNotification('Please enter valid fuel used amount', 'error');
                return false;
            }
            if (!data.unit_selection) {
                showNotification('Please select unit', 'error');
                return false;
            }
            return true;
        }

        // Validate transportation form data
        function validateTransportationFormData(data) {
            if (!data.date) {
                showNotification('Please select a date', 'error');
                return false;
            }
            if (!data.vehicle_no) {
                showNotification('Please enter vehicle number', 'error');
                return false;
            }
            if (!data.transportation_type) {
                showNotification('Please select transportation type', 'error');
                return false;
            }
            if (!data.distance_traveled || data.distance_traveled <= 0) {
                showNotification('Please enter valid distance traveled', 'error');
                return false;
            }
            if (!data.unit_selection) {
                showNotification('Please select unit', 'error');
                return false;
            }
            return true;
        }

        // Create fuel display row
        function createFuelDisplayRow(data) {
            const tbody = document.querySelector('#fuelMethodTableBody');
            const displayRow = document.createElement('tr');
            displayRow.className = 'data-display-row';
            
            displayRow.innerHTML = `
                <td>${data.s_no}</td>
                <td>${formatDate(data.date)}</td>
                <td>${data.vehicle_no}</td>
                <td>${data.fuel_selection}</td>
                <td>${data.fuel_used}</td>
                <td>${data.unit_selection}</td>
                <td>${data.efco2.toFixed(4)}</td>
                <td>${data.efch4.toFixed(4)}</td>
                <td>${data.efn20.toFixed(4)}</td>
                <td>${data.eco2.toFixed(2)}</td>
                <td>${data.ech4.toFixed(2)}</td>
                <td>${data.en20.toFixed(2)}</td>
                <td>${data.etco2eq.toFixed(2)}</td>
                <td>
                    <button type="button" class="btn btn-danger btn-sm delete-row-btn">
                        <i class="fa fa-trash"></i> Delete
                    </button>
                </td>
            `;

            const entryRow = tbody.querySelector('.data-entry-row');
            tbody.insertBefore(displayRow, entryRow);

            // Setup delete functionality
            displayRow.querySelector('.delete-row-btn').addEventListener('click', () => {
                if (confirm('Are you sure you want to delete this record?')) {
                    displayRow.remove();
                    showNotification('Record deleted successfully', 'success');
                }
            });
        }

        // Create transportation display row
        function createTransportationDisplayRow(data) {
            const tbody = document.querySelector('#transportationMethodTableBody');
            const displayRow = document.createElement('tr');
            displayRow.className = 'data-display-row';
            
            displayRow.innerHTML = `
                <td>${data.s_no}</td>
                <td>${formatDate(data.date)}</td>
                <td>${data.vehicle_no}</td>
                <td>${data.transportation_type}</td>
                <td>${data.distance_traveled}</td>
                <td>${data.unit_selection}</td>
                <td>${data.efco2.toFixed(4)}</td>
                <td>${data.efch4.toFixed(4)}</td>
                <td>${data.efn20.toFixed(4)}</td>
                <td>${data.eco2.toFixed(2)}</td>
                <td>${data.ech4.toFixed(2)}</td>
                <td>${data.en20.toFixed(2)}</td>
                <td>${data.etco2eq.toFixed(2)}</td>
                <td>
                    <button type="button" class="btn btn-danger btn-sm delete-row-btn">
                        <i class="fa fa-trash"></i> Delete
                    </button>
                </td>
            `;

            const entryRow = tbody.querySelector('.data-entry-row');
            tbody.insertBefore(displayRow, entryRow);

            // Setup delete functionality
            displayRow.querySelector('.delete-row-btn').addEventListener('click', () => {
                if (confirm('Are you sure you want to delete this record?')) {
                    displayRow.remove();
                    showNotification('Record deleted successfully', 'success');
                }
            });
        }

        // Clear fuel entry row
        function clearFuelEntryRow(row) {
            row.querySelector('.date-input').value = '';
            row.querySelector('.vehicle-no-input').value = '';
            row.querySelector('.fuel-selection-select').value = '';
            row.querySelector('.fuel-used-input').value = '';
            row.querySelector('.unit-selection-select').value = '';
            row.querySelector('.efco2-input').value = '';
            row.querySelector('.efch4-input').value = '';
            row.querySelector('.efn20-input').value = '';
            row.querySelector('.eco2-input').value = '';
            row.querySelector('.ech4-input').value = '';
            row.querySelector('.en20-input').value = '';
            row.querySelector('.etco2eq-input').value = '';
        }

        // Clear transportation entry row
        function clearTransportationEntryRow(row) {
            row.querySelector('.date-input').value = '';
            row.querySelector('.vehicle-no-input').value = '';
            row.querySelector('.transportation-type-select').value = '';
            row.querySelector('.distance-traveled-input').value = '';
            row.querySelector('.unit-selection-select').value = '';
            row.querySelector('.efco2-input').value = '';
            row.querySelector('.efch4-input').value = '';
            row.querySelector('.efn20-input').value = '';
            row.querySelector('.eco2-input').value = '';
            row.querySelector('.ech4-input').value = '';
            row.querySelector('.en20-input').value = '';
            row.querySelector('.etco2eq-input').value = '';
        }

        // Load existing data (placeholder for Frappe integration)
        function loadExistingData() {
            console.log('Loading existing data...');
            // This would integrate with Frappe to load existing records
        }

        // Utility functions
        function formatDate(dateString) {
            if (!dateString) return '-';
            const date = new Date(dateString);
            return date.toLocaleDateString();
        }

        function showNotification(message, type) {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 16px 20px;
                border-radius: 8px;
                color: white;
                font-weight: 500;
                z-index: 1000;
                animation: slideIn 0.3s ease;
            `;
            
            if (type === 'success') {
                notification.style.background = '#28a745';
            } else {
                notification.style.background = '#dc3545';
            }
            
            notification.textContent = message;
            document.body.appendChild(notification);
            
            // Auto remove after 3 seconds
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Initialize when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeApp);
        } else {
            initializeApp();
        }
    </script>
</body>
</html>